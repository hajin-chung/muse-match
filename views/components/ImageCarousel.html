<div class="h-[540px] flex flex-col w-full p-10">
  <div class="relative w-full h-full">
    {{ range .Images }}
    <div
      class="absolute top-0 left-0 w-full h-full transition-all slide"
      style="opacity: 0"
    >
      <img
        src="/image?id={{- .Id -}}"
        draggable="false"
        class="object-contain w-full h-full"
      />
    </div>
    {{ end }}
  </div>
</div>

<script>
  const slides = [...document.querySelectorAll(".slide")];
  let currentSlide = 0;
  let pos;

  slides[currentSlide].style.opacity = "100%";
  slides.forEach((slide) => {
    slide.onmousedown = (e) => {
      pos = { x: e.clientX, y: e.clientY };
    };
    slide.onmouseup = (e) => {
      if (!pos) return;
      const dx = e.clientX - pos.x;
      const dy = e.clientY - pos.y;
      pos = undefined;

      if (dx < 0) next();
      else if (dx > 0) prev();
    };
    slide.ontouchstart = (e) => {
      pos = {x:e.touches[0].clientX, y: e.touches[0].clientY};
    }
    slide.ontouchend = (e) => {
      console.log(e)
      if (!pos) return;
      const dx = e.changedTouches[0].clientX - pos.x;
      const dy = e.changedTouches[0].clientY - pos.y;
      pos = undefined;

      if (dx < 0) next();
      else if (dx > 0) prev();
    };
  });

  function next() {
    if (currentSlide >= slides.length - 1) {
      return;
    }

    slides[currentSlide].style.opacity = 0;
    currentSlide++;
    slides[currentSlide].style.opacity = 1;
  }

  function prev() {
    if (currentSlide <= 0) {
      return;
    }

    slides[currentSlide].style.opacity = 0;
    currentSlide--;
    slides[currentSlide].style.opacity = 1;
  }
</script>
